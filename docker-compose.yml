version: '2'
services:
  redis:
    image: redis:3.2.6-alpine
    volumes:
      - "vol_redis:/data"
    restart: always
    command: redis-server --appendonly yes

  webapp:
    depends_on:
      - redis
    image: webapp_build:latest
    links:
      - redis
    ports:
      - "80:80"
    restart: always
    environment:
      - redis_port=6379
      - redis_host=redis

volumes:
  vol_redis:
    driver: netapp
    driver_opts:
      size: "10g"
      snapshotDir: "false"
